<!DOCTYPE html>
<html>
<head>
    <title>Iran Visa Application Form Submission</title>
    <link rel="stylesheet" type="text/css" href="submittedDetailsStyles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="submitted-details">
        <div class="details-title">Iran Visa Application Form</div>
        <div class="sub-text">Applicant Submitted Details
        <div class="company-name">Skyworld GmbH</div>

        <div class="submitted-columns">
            <div class="column">
                <table class="details-table" id="applicantDetails">
                    <!-- Applicant details will be displayed here -->
                </table>
            </div>
        </div>

        <div class="submission-info">
            <p><strong>Submission Date and Time:</strong> <span id="submissionDateTime"></span></p>
            <p><strong>Reference Number:</strong> <span id="referenceNumber"></span></p>
        </div>

        <div class="buttons-container">
            <button class="action-button" onclick="printForm()">Print</button>
            <button class="action-button" onclick="downloadPDF()">Download PDF</button>
            <button class="action-button" onclick="exportToExcel()">Extract to Excel</button>
        </div>
    </div>

    <script>
        function displayFormData() {
            const formData = JSON.parse(localStorage.getItem('formData'));
            if (formData) {
                let detailsHtml = '<tr><th>Application Questions</th><th>Applicant Submitted Details</th></tr>';
                for (const key in formData) {
                    let formattedKey = key.replace(/([A-Z])/g, ' $1').trim();
                    formattedKey = formattedKey.charAt(0).toUpperCase() + formattedKey.slice(1);
                    detailsHtml += `<tr><td>${formattedKey}</td><td>${formData[key]}</td></tr>`;
                }
                document.getElementById('applicantDetails').innerHTML = detailsHtml;
                document.getElementById('submissionDateTime').textContent = formData.submissionTime;
                document.getElementById('referenceNumber').textContent = formData.referenceNumber;
            }
        }

        displayFormData();

        function printForm() {
            window.print();
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let y = 10;
            const formData = JSON.parse(localStorage.getItem('formData'));
            for (const key in formData) {
                doc.text(`${key}: ${formData[key]}`, 10, y);
                y += 10;
            }
            doc.save('submitted-details.pdf');
        }

        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            const formData = JSON.parse(localStorage.getItem('formData'));
            for (const key in formData) {
                csvContent += key + "," + formData[key] + "\r\n";
            }
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "submitted-details.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
